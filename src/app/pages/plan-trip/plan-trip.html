<app-sidebar></app-sidebar>

<div class="min-h-screen bg-gradient-to-br from-white via-gray-100 to-gray-200 text-gray-900 px-6 py-12 pb-32">

  <div class="max-w-5xl mx-auto text-center">
    <h1 class="text-4xl md:text-5xl font-bold mb-6 animate-fade-in text-gray-900">
      ğŸ§­ Your AI Trip Planner
    </h1>

    <p class="text-gray-700 text-lg mb-6">
      Let Raahi 2.0 craft your personalized travel itinerary based on your preferences
    </p>

    <!-- Trip Name Input -->
    <div class="mb-8 max-w-xl mx-auto">
      <label class="block mb-2 text-lg font-semibold text-gray-800">Trip Name</label>
      <input
        [(ngModel)]="tripName"
        class="w-full p-3 rounded-lg text-gray-900 border border-gray-300"
        type="text"
      />
    </div>

    <!-- Start Time Input -->
    <div class="mb-6 max-w-xl mx-auto">
      <label class="block mb-2 text-lg font-semibold text-gray-800">Start Time</label>
      <input
        [(ngModel)]="startTime"
        type="time"
        class="w-full p-3 rounded-lg text-gray-900 border border-gray-300"
      />
    </div>

    <!-- Cutoff Time Input -->
    <div class="mb-8 max-w-xl mx-auto">
      <label class="block mb-2 text-lg font-semibold text-gray-800">Day Cutoff Time</label>
      <input
        [(ngModel)]="cutoffTime"
        type="time"
        class="w-full p-3 rounded-lg text-gray-900 border border-gray-300"
      />
    </div>

    <!-- Generate Button -->
    <button
      (click)="generateTrip()"
      [disabled]="loading"
      class="px-8 py-4 rounded-xl bg-gradient-to-r from-orange-400 to-pink-500 text-white font-semibold hover:opacity-90 transition"
    >
      {{ loading ? "Generating your trip..." : "Generate AI Trip Plan" }}
    </button>

    <!-- Itinerary Output -->
    <div *ngIf="itinerary" class="mt-12 text-left space-y-10 animate-fade-in">

      <h2 class="text-3xl font-bold mb-6 text-center text-gray-900">
        âœ¨ {{ itinerary.destination }} Itinerary
      </h2>

      <!-- DAY CARDS -->
      <div class="space-y-10">
        <div
          *ngFor="let day of itinerary.plan"
          class="bg-white/40 backdrop-blur-xl rounded-2xl shadow-xl border border-gray-300 p-8"
        >
          <h3 class="text-3xl font-semibold mb-6 text-gray-900">
            Day {{ day.day }}
          </h3>

          <div class="space-y-6">
            <div
              *ngFor="let act of day.activities"
              class="bg-white/60 rounded-xl p-4 border border-gray-300"
            >
              <div class="flex justify-between items-start">

                <!-- LEFT -->
                <div>
                  <div class="font-semibold text-lg text-gray-900">
                    {{ act.startTime }} â†’ {{ act.endTime }} â€” {{ act.name }}
                  </div>
                  <span
  *ngIf="act.isHiddenGem"
  class="inline-block mt-1 px-2 py-0.5 text-xs font-semibold rounded-full bg-purple-100 text-purple-700"
>
  ğŸ’ Hidden Gem
</span>


                  <div class="text-sm text-gray-700 mt-1">
                    ğŸ‘‰ {{ act.reason }}
                  </div>

                  <div *ngIf="act.travelMinutes > 0" class="text-xs text-gray-600 mt-1">
                    ğŸš— Travel: {{ act.travelMinutes }} mins
                  </div>
                </div>

                <!-- RIGHT (ONLY DELAY NOW) -->
                <div>
                  <button
                    (click)="openDelayPopup(act.baseIndex, act.name)"
                    class="px-3 py-1 bg-yellow-400 text-black text-xs font-semibold rounded-lg hover:bg-yellow-300"
                  >
                    â³ Delay
                  </button>
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Save / Home Buttons -->
      <div class="mt-10 text-center">
        <button
          (click)="saveTrip()"
          class="mt-6 px-6 py-3 bg-green-500 text-white font-semibold rounded-xl hover:bg-green-600 transition"
        >
          Save Trip
        </button>

        <button
          (click)="goHome()"
          class="mt-6 ml-4 px-6 py-3 bg-white text-teal-700 font-semibold rounded-xl hover:shadow-lg transition"
        >
          Back to Home
        </button>
      </div>

    </div>

  </div>

  <!-- SMART SUGGESTIONS -->
  <div
    class="fixed w-72 z-50 hidden lg:block"
    [ngStyle]="{ top: dragPos.y + 'px', left: dragPos.x + 'px' }"
    (mousedown)="startDrag($event)"
    (touchstart)="startDrag($event)"
  >
    <div class="bg-white/50 backdrop-blur-xl border border-gray-300 rounded-2xl shadow-xl p-6 cursor-move">

      <h3 class="text-xl font-bold text-gray-800 mb-3">
        ğŸŒŸ Smart Suggestions
      </h3>

      <!-- ğŸ‘ Top Liked -->
      <div *ngIf="topLiked.length > 0" class="mb-6">
        <h4 class="text-lg font-semibold text-gray-800 mb-2">
          ğŸ‘ Travellers Love These
        </h4>

        <div class="space-y-2">
          <div *ngFor="let p of topLiked" class="bg-white/70 p-3 rounded-lg border border-gray-300">
            <div class="font-semibold text-gray-800">{{ p.place }}</div>
            <div class="text-sm text-gray-600">Likes: {{ p.score }}</div>
          </div>
        </div>
      </div>

      <!-- â­ Top Rated -->
      <div *ngIf="topRated.length > 0" class="mb-6">
        <h4 class="text-lg font-semibold text-gray-800 mb-2">
          â­ Highly Rated by Travellers
        </h4>

        <div class="space-y-2">
          <div *ngFor="let r of topRated" class="bg-white/70 p-3 rounded-lg border border-gray-300">
            <div class="font-semibold text-gray-800">{{ r.place }}</div>
            <div class="text-sm text-gray-600">
              â­ {{ r.avgRating | number:'1.1-1' }} ({{ r.count }} ratings)
            </div>
          </div>
        </div>
      </div>

      <!-- ğŸ‘¥ Similar Travellers -->
      <div *ngIf="similarTraveller.length > 0" class="mb-6">
        <h4 class="text-lg font-semibold text-gray-800 mb-2">
          ğŸ‘¥ People Like You Also Visited
        </h4>

        <div class="space-y-2">
          <div *ngFor="let p of similarTraveller" class="bg-white/70 p-3 rounded-lg border border-gray-300">
            <div class="font-semibold text-gray-800">{{ p }}</div>
          </div>
        </div>
      </div>

      <!-- ğŸŒ Social Media -->
      <div *ngIf="socialRecommendations.length > 0">
        <h4 class="text-lg font-semibold text-gray-800 mb-2">
          ğŸŒ Based on Your Posts
        </h4>

        <div *ngFor="let s of socialRecommendations" class="bg-white/70 p-3 rounded-lg border border-gray-300 mb-2">
          <div class="flex justify-between">
            <span class="font-semibold text-gray-800">{{ s.place }}</span>
            <span class="text-sm text-gray-600">Score: {{ s.score }}</span>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>
