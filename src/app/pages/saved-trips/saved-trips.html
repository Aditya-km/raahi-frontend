<app-sidebar></app-sidebar>

<div class="min-h-screen bg-gradient-to-br from-white via-gray-100 to-gray-200 px-6 py-12 pb-32 text-gray-900">
  <div class="max-w-6xl mx-auto">

    <h1 class="text-4xl md:text-5xl font-bold text-center mb-10 animate-fade-in text-gray-900">
      ğŸŒŸ Your Saved Trips
    </h1>

    <!-- Loading -->
    <div *ngIf="loading" class="text-center text-gray-600 text-lg">Loading your trips...</div>

    <!-- No Trips -->
    <div *ngIf="!loading && trips.length === 0" class="text-center text-gray-600 mt-10">
      You haven't saved any trips yet.<br />
      <a routerLink="/plan" class="underline text-orange-600 hover:text-orange-700">Plan a new trip â†’</a>
    </div>

    <!-- Trips Grid -->
    <div *ngIf="!loading && trips.length > 0"
         class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8 mt-8">

      <div *ngFor="let t of trips"
           class="trip-card bg-white/70 rounded-2xl shadow-lg backdrop-blur-lg overflow-hidden hover:shadow-2xl transition transform hover:-translate-y-1">

        <div class="h-40 w-full bg-cover bg-center"
             [style.background-image]="'url(assets/' + t.plan.destination.toLowerCase() + '.jpg)'">
        </div>

        <div class="p-5 text-left text-gray-900">
          <h2 class="text-2xl font-semibold mb-2">{{ t.plan.tripName }}</h2>

          <p class="text-gray-700 text-sm mb-1">ğŸ“ {{ t.plan.destination }}</p>
          <p class="text-gray-600 text-sm mb-4">ğŸ“… {{ t.plan.startDate }} â†’ {{ t.plan.endDate }}</p>

          <div class="flex justify-between items-center mt-4">
            <button (click)="viewTrip(t)"
              class="px-4 py-2 bg-gradient-to-r from-orange-400 to-pink-500 text-white rounded-lg font-semibold hover:opacity-90 transition">
              View
            </button>

            <button (click)="deleteTrip(t.id)"
              class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
              Delete
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- ğŸŒŸ Trip Details Modal -->
<div *ngIf="showModal"
     class="fixed inset-0 bg-black/50 backdrop-blur-md flex justify-center items-center z-50">

  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8 text-black relative animate-modal">

    <button (click)="closeModal()"
            class="absolute top-3 right-3 text-gray-700 hover:text-black text-xl">âœ–</button>

    <h2 class="text-3xl font-bold text-center mb-5 text-gray-900">{{ selectedTrip?.tripName }}</h2>

    <p class="text-gray-600 text-center mb-4">
      ğŸ“ {{ selectedTrip?.destination }} <br />
      ğŸ“… {{ selectedTrip?.startDate }} â†’ {{ selectedTrip?.endDate }}
    </p>

    <div class="space-y-6 max-h-[400px] overflow-y-auto pr-2">

      <div *ngFor="let day of selectedTrip?.itinerary" class="border-l-4 border-orange-500 pl-4">

        <h3 class="text-xl font-semibold mb-1 text-gray-900">
          Day {{ day.day }} â€” {{ day.title }}
        </h3>

        <ul class="pl-4 text-gray-700 space-y-3">

          <li *ngFor="let act of day.activities" class="bg-gray-100 p-3 rounded-lg">

            <div class="font-bold text-lg text-gray-900">{{ act.name }}</div>

            <div class="text-sm text-gray-600">
              ğŸ•’ {{ act.startTime }} â†’ {{ act.endTime }}  
              <br/>
              â³ {{ act.durationMinutes }} min  
              <br/>
              â„¹ {{ act.reason }}
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 mt-3">

              <button (click)="likePlace(act.name)"
                class="px-3 py-1 bg-red-500 text-white rounded-lg text-sm">â¤ï¸ Like</button>

              <button (click)="skipPlace(act.name)"
                class="px-3 py-1 bg-gray-500 text-white rounded-lg text-sm">ğŸš« Skip</button>

              <select (change)="ratePlace(act.name, $any($event.target).value)"

        class="px-2 py-1 border rounded text-sm">

                <option value="">â­ Rate</option>
                <option *ngFor="let r of [1,2,3,4,5]" [value]="r">{{ r }} Star</option>
              </select>

              <button (click)="openDelayPopup(act)"
                class="px-3 py-1 bg-orange-500 text-white rounded-lg text-sm">
                â³ Delay
              </button>

            </div>

          </li>

        </ul>

      </div>

    </div>

    <div class="text-center mt-6">
      <button class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
              (click)="closeModal()">Close</button>
    </div>

  </div>
</div>

<!-- Delay Popup Modal -->
<div *ngIf="showDelayPopup"
     class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 backdrop-blur-sm">
  <div class="bg-white p-6 rounded-xl shadow-lg w-80">

    <h3 class="text-xl font-semibold mb-3">Apply Delay</h3>

    <input type="number" [(ngModel)]="delayInput"
           placeholder="Delay amount" class="w-full border p-2 rounded mb-3"/>

    <select [(ngModel)]="delayUnit" class="w-full border p-2 rounded mb-4">
      <option value="min">Minutes</option>
      <option value="hr">Hours</option>
    </select>

    <div class="flex justify-end gap-3">
      <button (click)="showDelayPopup=false" class="px-4 py-1 bg-gray-300 rounded">Cancel</button>
      <button (click)="applyDelay()" class="px-4 py-1 bg-orange-500 text-white rounded">Apply</button>
    </div>

  </div>
</div>

<!-- Skip Popup -->
<div *ngIf="showSkipPopup"
     class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 backdrop-blur-sm">
  <div class="bg-white p-6 rounded-xl shadow-lg w-80">

    <h3 class="text-xl font-semibold mb-3">Select activities to skip</h3>

    <div class="space-y-2 max-h-40 overflow-y-auto">
      <div *ngFor="let ov of overflowActivities">
        <label class="flex items-center gap-2">
          <input type="checkbox"
                 (change)="toggleSkipSelection(ov.baseIndex, $event.target.checked)">
          {{ ov.name }}
        </label>
      </div>
    </div>

    <div class="flex justify-end gap-3 mt-4">
      <button (click)="showSkipPopup=false" class="px-4 py-1 bg-gray-300 rounded">Cancel</button>
      <button (click)="applySkip()" class="px-4 py-1 bg-orange-500 text-white rounded">Confirm</button>
    </div>

  </div>
</div>
